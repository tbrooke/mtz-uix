(ns app.pages
  (:require [app.ui :as ui]
            [app.api :as api]
            [uix.core :refer [$ defui use-state use-effect]]))

(defui home-page []
  (let [[features set-features!] (use-state [])
        [loading set-loading!] (use-state true)
        [error set-error!] (use-state nil)]
    
    (use-effect
     (fn []
       (-> (api/get-homepage-features)
           (.then (fn [response]
                    (set-features! (:data response))
                    (set-loading! false)))
           (.catch (fn [err]
                     (set-error! (str "Error loading features: " (.-message err)))
                     (set-loading! false)))))
     [])
    
    ($ ui/mtz-app
       ($ ui/mtz-hero
          {:welcome-text "Welcome to"
           :title "Mount Zion United Church of Christ"
           :subtitle "China Grove, NC"
           :description "A welcoming community of faith where all are invited to experience God's love, grow in spiritual understanding, and serve others with compassion."
           :buttons [{:text "Join Us Sunday" :variant :primary}
                     {:text "Learn More" :variant :secondary}]})

       ;; Dynamic features section from API
       ($ :section.py-16.px-4
          ($ :div.max-w-4xl.mx-auto
             ($ ui/heading {:class "text-3xl text-center mb-8"} "Latest News")
             (cond
               loading ($ :div.text-center.py-8 ($ ui/p "Loading..."))
               error ($ :div.text-center.py-8.text-red-600 ($ ui/p error))
               :else ($ :div.grid.md:grid-cols-2.gap-6
                        (for [feature (sort-by :attributes.display_order features)]
                          (let [attrs (:attributes feature)
                                image (:image attrs)]
                            ($ :div.bg-white.rounded-lg.p-6.shadow-md
                               {:key (:id feature)}
                               (when image
                                 ($ :img.w-full.h-48.object-cover.rounded-lg.mb-4
                                    {:src (str "http://localhost:1337" (get-in image [:data :attributes :url]))
                                     :alt (or (get-in image [:data :attributes :alternativeText]) (:title attrs))}))
                               ($ :h4.text-xl.font-bold.mb-2 (:title attrs))
                               ($ ui/p (:content attrs))
                               (when (:button_text attrs)
                                 ($ :div.mt-4
                                    ($ ui/button
                                       {:variant (keyword (or (:button_style attrs) "primary"))
                                        :href (:button_url attrs)}
                                       (:button_text attrs)))))))))))))

(defui about-page []
  ($ ui/mtz-app
     ($ :section.py-16.px-4
        ($ :div.max-w-4xl.mx-auto
           ($ ui/heading {:class "text-5xl text-center mb-8"} "About Mount Zion UCC")
           ($ ui/p "Our church has been serving the China Grove community for generations, providing a welcoming space for worship, fellowship, and spiritual growth.")))))

(defui worship-page []
  ($ ui/mtz-app
     ($ :section.py-16.px-4
        ($ :div.max-w-4xl.mx-auto.text-center
           ($ ui/heading {:class "text-5xl mb-8"} "Worship With Us")
           ($ ui/p {:class "text-xl mb-8"} "Join us every Sunday for meaningful worship, inspiring music, and community fellowship.")
           ($ :div.bg-blue-50.rounded-lg.p-8
              ($ :h3.text-3xl.font-bold.mb-4.text-blue-800 "Sunday Service")
              ($ ui/p "10:00 AM every Sunday")
              ($ ui/p "1234 Church Street, China Grove, NC"))))))

(defui events-page []
  ($ ui/mtz-app
     ($ :section.py-16.px-4
        ($ :div.max-w-4xl.mx-auto
           ($ ui/heading {:class "text-5xl text-center mb-8"} "Upcoming Events")
           ($ :div.grid.gap-6
              ($ :div.bg-blue-50.rounded-lg.p-6
                 ($ :h3.text-2xl.font-bold.mb-2.text-blue-800 "Sunday Worship")
                 ($ ui/p "Every Sunday at 10:00 AM")
                 ($ ui/p "Join us for worship and fellowship."))
              ($ :div.bg-blue-50.rounded-lg.p-6
                 ($ :h3.text-2xl.font-bold.mb-2.text-blue-800 "Bible Study")
                 ($ ui/p "Wednesdays at 7:00 PM")
                 ($ ui/p "Deepen your faith through scripture study.")))))))

(defui ministries-page []
  ($ ui/mtz-app
     ($ :section.py-16.px-4
        ($ :div.max-w-4xl.mx-auto
           ($ ui/heading {:class "text-5xl text-center mb-8"} "Our Ministries")
           ($ ui/p "Discover the many ways to get involved and serve in our church community.")))))

(defui contact-page []
  ($ ui/mtz-app
     ($ :section.py-16.px-4
        ($ :div.max-w-4xl.mx-auto
           ($ ui/heading {:class "text-5xl text-center mb-8"} "Contact Us")
           ($ :div.grid.md:grid-cols-2.gap-8
              ($ :div
                 ($ :h3.text-2xl.font-bold.mb-4 "Visit Us")
                 ($ ui/p "1234 Church Street")
                 ($ ui/p "China Grove, NC 28023"))
              ($ :div
                 ($ :h3.text-2xl.font-bold.mb-4 "Service Times")
                 ($ ui/p "Sunday Worship: 10:00 AM")))))))